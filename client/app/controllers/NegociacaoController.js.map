{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DataConverter","getNegociacaoDao","Bind","getExceptionMessage","debounce","controller","NegociacaoController","constructor","_inputData","_inputQuantidade","_inputValor","Object","assign","_negociacoes","_mensagem","_service","_init","dao","negociacoes","listaTodos","forEach","negociacao","adiciona","err","texto","_criaNegociacao","data","paraData","value","parseInt","_inpuQuantidade","parseFloat","_limpaFormulario","focus","importaNegociacoes","obterNegociacoesDoPeriodo","filter","novaNegociacao","paraArray","some","negociacaoExistente","equals","event","preventDefault","e","apaga","apagaTodos","esvazia"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao } from '../domain/index.js';\r\nimport { NegociacoesView, MensagemView, Mensagem, DataConverter } from '../ui/index.js';\r\nimport { getNegociacaoDao, Bind, getExceptionMessage, debounce, controller } from '../util/index.js';\r\n\r\n@controller('#data', '#quantidade', '#valor')\r\nexport class NegociacaoController {\r\n\r\n    constructor(_inputData, _inputQuantidade, _inputValor) {\r\n        Object.assign(this, { _inputData, _inputQuantidade, _inputValor});\r\n        //const $ = document.querySelector.bind(document);\r\n        /*this._inputData = _inputData; //$(\"#data\");\r\n        this._inpuQuantidade = inputQuantidade; // $(\"#quantidade\");\r\n        this._inputValor = inputValor; // $(\"#valor\");*/\r\n        this._negociacoes = new Bind(new Negociacoes(), new NegociacoesView(\"#negociacoes\"), 'adiciona','esvazia');\r\n        this._mensagem = new Bind(new Mensagem(), new MensagemView(\"#mensagemView\"), 'texto');\r\n        this._service = new NegociacaoService();\r\n        this._init();\r\n    }\r\n    async _init() {\r\n        try {\r\n            const dao = await getNegociacaoDao();\r\n            const negociacoes = await dao.listaTodos();\r\n            negociacoes.forEach(negociacao => this._negociacoes.adiciona(negociacao))\r\n        } catch(err) {\r\n            this._mensagem.texto = getExceptionMessage(err);\r\n        }\r\n    }\r\n    _criaNegociacao() {\r\n        let data = DataConverter.paraData(this._inputData.value);\r\n        return new Negociacao(\r\n            data,\r\n            parseInt(this._inpuQuantidade.value),\r\n            parseFloat(this._inputValor.value));\r\n    }\r\n    _limpaFormulario() {\r\n        this._inputData.value = '';\r\n        this._inpuQuantidade.value = 1;\r\n        this._inputValor.value = 0.0;\r\n        this._inputData.focus();\r\n    }\r\n\r\n    @debounce(1500)\r\n    async importaNegociacoes() {\r\n        try {\r\n            const negociacoes = await this._service.obterNegociacoesDoPeriodo();\r\n            negociacoes\r\n                .filter(novaNegociacao => !this._negociacoes.paraArray()\r\n                    .some(negociacaoExistente => novaNegociacao.equals(negociacaoExistente)))\r\n                .forEach(negociacao => this._negociacoes.adiciona(negociacao));\r\n            this._mensagem.texto = 'Negociações do período importadas com sucesso';\r\n        } catch(err) {\r\n            this._mensagem.texto = getExceptionMessage(err);\r\n        }        \r\n    }\r\n\r\n    @debounce()\r\n    async adiciona(event) {\r\n        try {\r\n            event.preventDefault();\r\n            const negociacao = this._criaNegociacao();\r\n\r\n            const dao = await getNegociacaoDao();\r\n            await dao.adiciona(negociacao);\r\n            this._negociacoes.adiciona(negociacao);\r\n            this._mensagem.texto = \"Negociação incluída com sucesso!\";\r\n            this._limpaFormulario();\r\n\r\n        } catch (e) {\r\n            this._mensagem.texto = getExceptionMessage(err);\r\n        }\r\n    }\r\n\r\n    async apaga() {\r\n        try {\r\n            const dao = await getNegociacaoDao();\r\n            await dao.apagaTodos();\r\n            this._negociacoes.esvazia();\r\n            this._mensagem.texto = \"Negociações apagadas com sucesso\";\r\n        } catch(err) {\r\n            this._mensagem.texto = getExceptionMessage(err);\r\n        }\r\n        \r\n    }\r\n\r\n}"]}